{% extends 'base.html' %}

{% block title %}
Token Generation Page
{% endblock title %}

{% block content %}
<h1> Watch Your Seeds Grow! </h1>

<button style="background-color: transparent; border-color: transparent" type="submit"><a href="{% url 'handle_csv' %}"
        id="cleanList" class="btn btn-secondary">
        View Your Seedling!</a></button>

<button style="background-color: transparent; border-color: transparent" type="submit"><a href="{% url 'greenhouse_app:login_home' %}"
        class="btn btn-secondary" data-bs-container="body">
        Store Your Seedling in Your Pot</a></button>
        
        
        <script>
         
    const cleanList = document.querySelector("#clearList");
    fetch('http://127.0.0.1:8000/static/cleanedList.json')
        .then(function (response) {
            return response.json()
        })
        .then(function (data) {
            // console.log(data)
            let typedArray32Array = Uint32Array.from(data, z => z * 3200); //number 3200 can be any whole number*
            // document.write(typedArray32Array);
            const newTypedArray = new Uint32Array(typedArray32Array);
            self.crypto.getRandomValues(newTypedArray);
            console.log(newTypedArray)
            // for (const num of newTypedArray) {
            //     numToString = num.toString()
            //     newString = numToString.concat(numToString)
            //     console.log(newString)
            //     newNum = parseInt(newString)

            newNum = newTypedArray.join("")
            newNumnum = parseInt(newNum)

            const text = newNum;

            async function digestMessage(message) {
                const msgUint8 = new TextEncoder().encode(message);                           // encode as (utf-8) Uint8Array
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);           // hash the message
                const hashArray = Array.from(new Uint8Array(hashBuffer));                     // convert buffer to byte array
                const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string
                alert(hashHex)
                writeToFile('http://127.0.0.1:8000/static/cleanedList.json', hashHex);
                console.log(typeof(hashHex))
                return hashHex;  
            }
            digestMessage(text) 
            .then((digestHex) => console.log(digestHex));
        
        });
    

    

    function writeToFile(cleanedList, hashHex) {
        console.log("string")
  const file = new Blob([hashHex], {type: 'application/json'});
  const a = document.createElement('a');
  const url = URL.createObjectURL(file);
  a.href = url;
  a.download = cleanedList;
  document.body.appendChild(a);
//   a.alert(hashHex);
  setTimeout(function() {
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  }, 0);
}

        
        
        
            
</script>




{% endblock %}