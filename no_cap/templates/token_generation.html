{% extends 'base.html' %}
{% load static %}

{% block title %}
Token Generation Page
{% endblock title %}

{% block content %}
<h1> Watch Your Seeds Grow! </h1>

<button style="background-color: transparent; border-color: transparent" type="submit"><a href="{% url 'random_app:handle_csv' %}"
        id="cleanList" class="btn btn-secondary">
        View Your Seedling!</a></button>
        <!-- <a href="{% static 'downloads/clearList.json' %}"></a> -->

        
        <button style="background-color: transparent; border-color: transparent" type="submit"><a
            href="{% url 'greenhouse_app:login_home' %}" class="btn btn-secondary" data-bs-container="body">
            Store Your Seedling in Your Greenhouse</a></button>
            


<script>


    // const cleanList = document.querySelector("#clearList");
    fetch('http://127.0.0.1:8000/static/cleanedList.json')
        .then(function (response) {
            return response.json()
        })
        .then(function (data) {
        
            let typedArray32Array = Uint32Array.from(data, z => z * 3200); //number 3200 can be any whole number*
            const newTypedArray = new Uint32Array(typedArray32Array);
            self.crypto.getRandomValues(newTypedArray);
            console.log(newTypedArray)
            newNum = newTypedArray.join("")
            newNumnum = parseInt(newNum)
            const text = newNum;

            async function digestMessage(message) {
                const msgUint8 = new TextEncoder().encode(message);                           // encode as (utf-8) Uint8Array
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);           // hash the message
                const hashArray = Array.from(new Uint8Array(hashBuffer));                     // convert buffer to byte array
                const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string
                alert(hashHex)
                // console.log("this is hash" + typeof(hashHex))
                // const writeToDom = document.getElementById('writeToDom')
                // writeToDom.innerHTML = hashHex

                return hashHex;

            }
            
            digestMessage(text)
            .then((digestHex) => 
            console.log("this is digest" + (digestHex)))
            
            // console.log(digestMessage(text))

            digestMessage(text).then(function (response){
                // console.log(response)
                getHashHex = response
                console.log(getHashHex)
                // console.log(typeof(getHashHex))
                // writeToDom.value = getHashHex
                // window.location.replace(`http://127.0.0.1:8000/login_home/show_seedling/${getHashHex}`)
                return getHashHex
            })
        
            
            // .then((result)=>{fetch("http://127.0.0.1:8000/login_home/show_seedling", {
            //     method: 'POST',
            //     headers: {
            //     "X-CSRF-Token": csrfToken,
            //     'Content-Type': 'application/json',
            // },
            //     body: JSON.stringify(data),
                
            // })
            // .then((response) => response.json())
            // .then((result)=> {
            //     console.log(result)
            // })
        // });

// fetch(url, options).then(response => {
//     console.log(data['hashHex'])
});
        

    
            
        
        
    

</script>






{% endblock %}